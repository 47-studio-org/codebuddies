<template name="discussion">
  <div class="discussion">

  <div class="container">
    {{#if Template.subscriptionsReady}}
      {{#with discussion}}

        <div class="row">
          <!-- main section -->
          <div class="col-md-8">
            {{! discussion }}
            <div class="row discussion-card">
              <div class="col-md-1">
                <img src="{{author.avatar}}" alt="{{author.username}}" class="img-circle avatar author-avatar" />
                <h5 class="pull-right">{{author.username}}</h5>
              </div>
              <div class="col-md-11">
                <h3>{{topic}} <small>{{#if modified_at}}(Edited){{/if}} {{#if isAuthor author.id}}<div class="btn btn-sm btn-default pull-right" id="editDiscussion"> Edit </div>{{/if}} </small> </h3>
                <div class="description-text">
                  {{#markdown}}{{description}}{{/markdown}}
                </div>
                <hr>
                <h4>
                  <i class="fa fa-thumbs-o-up {{#if isInCollection up_votes}} upvoted {{else}} upvote {{/if}}" aria-hidden="true"></i> <small>{{up_votes.length}}</small> &nbsp; &nbsp;
                  <i class="fa fa-thumbs-o-down {{#if isInCollection down_votes}} downvoted {{else}} downvote {{/if}}" aria-hidden="true"></i> <small>{{down_votes.length}}</small> &nbsp; &nbsp;
                  <small><i class="fa fa-clock-o" aria-hidden="true"></i> Posted on : {{dispDate created_at}} </small> &nbsp; &nbsp;
                  <small><i class="fa fa-comments-o" aria-hidden="true"></i> {{response_count}} </small> &nbsp; &nbsp;
                  <small><i class="fa fa-eye" aria-hidden="true"></i> {{views}} </small> &nbsp; &nbsp;
                  <small><a href="{{pathFor 'study group' studyGroupSlug=study_group.slug studyGroupId=study_group.id}}"><span class="label label-default">{{truncateIt study_group.title '30'}}</span></a></small> &nbsp; &nbsp;
                </h4>
              </div>
            </div>

            {{! comments }}

            {{#unless responses.count}}
              <!-- todo filter-->

            {{/unless}}
            {{#each responses}}
              <div class="row discussion-card">
                <div class="col-md-1">
                  <img src="{{author.avatar}}" alt="{{author.username}}" class="img-circle avatar author-avatar" />
                  <h5 class="pull-right">{{author.username}}</h5>
                </div>
                <div class="col-md-11">
                  <div class="description-text">
                    {{#markdown}}{{text}}{{/markdown}}
                  </div>
                  <hr>
                  <h4>
                    <small><i class="fa fa-clock-o" aria-hidden="true"></i> Posted on : {{dispDate created_at}} </small> &nbsp; &nbsp;
                    <small>{{#if modified_at}}(Edited){{/if}}</small> &nbsp; &nbsp;
                    <small>{{#if isAuthor author.id}}<div class="btn btn-sm btn-default pull-right" id="editResponse"> Edit </div>{{/if}} </small>
                  </h4>
                  <!-- <h4>
                    <i class="fa fa-thumbs-o-up {{#if isInCollection up_votes}} upvoted {{else}} upvote {{/if}}" aria-hidden="true"></i> <small>{{up_votes.length}}</small> &nbsp; &nbsp;
                    <i class="fa fa-thumbs-o-down {{#if isInCollection down_votes}} downvoted {{else}} downvote {{/if}}" aria-hidden="true"></i> <small>{{down_votes.length}}</small> &nbsp; &nbsp;
                    <small><i class="fa fa-clock-o" aria-hidden="true"></i> Posted on : {{dispDate created_at}} </small> &nbsp; &nbsp;
                    <small><i class="fa fa-comments-o" aria-hidden="true"></i> {{response_count}} </small> &nbsp; &nbsp;
                    <small><i class="fa fa-eye" aria-hidden="true"></i> {{views}} </small> &nbsp; &nbsp;
                    <small><a href="{{pathFor 'study group' studyGroupSlug=study_group.slug studyGroupId=study_group.id}}"><span class="label label-default">{{truncateIt study_group.title '30'}}</span></a></small> &nbsp; &nbsp;
                  </h4> -->
                </div>
              </div>
            {{/each}}


            {{! response }}
            <div class="row discussion-card">
              {{#if currentUser}}
                <div class="col-md-1">
                  <img src="{{currentUser.profile.avatar.default}}" alt="{{currentUser.username}}" class="img-circle avatar author-avatar" />
                </div>
                <div class="col-md-11">
                  <div>
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                      <li role="presentation" class="active"><a href="#responseWrite" aria-controls="responseWrite" role="tab" data-toggle="tab">Write</a></li>
                      <li role="presentation"><a href="#responsePreview" aria-controls="responsePreview" role="tab" data-toggle="tab">Preview</a></li>
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">
                      <div role="tabpanel" class="tab-pane active" id="responseWrite">
                        <textarea class="form-control" id="discussionResponse" rows="5" cols="70" placeholder="Type your reply here"></textarea>
                      </div>
                      <div role="tabpanel" class="tab-pane preview-pane" id="responsePreview">
                        {{#markdown}}{{discussionResponsePreview}}{{/markdown}}
                      </div>
                    </div>
                  </div>
                  <br>
                  <div class="btn btn-default pull-right" id="addResponseToDiscussion">Reply</div>
                </div>

              {{/if}}
            </div>


          </div>
          <!-- main section ends-->

          <!-- right sidebar -->
          <div class="col-md-3 col-md-offset-1">
            <div class="discussion-sidebar">
              <h5>PEOPLE IN THIS DISCUSSION</h5>
              <hr>
              {{#each participants}}
                <img src="{{avatar}}" alt="{{username}}" class="img-circle avatar author-avatar" />
              {{/each}}
            </div>

            {{#if currentUser}}
              <div class="discussion-sidebar">
                <h5>NOTIFICATION</h5>
                <hr>
                {{#if isInCollection subscribers}}
                  <div class="btn btn-sm btn-block btn-default" id="unsubscribe">
                    unsubscribe
                  </div>
                  You’re receiving notifications because you’re subscribed to this thread.
                {{else}}
                  <div class="btn btn-sm btn-block btn-default" id="subscribe">
                    subscribe
                  </div>
                  You’re ignoring this thread.
                {{/if}}
              </div>

              {{! @todo display 5 active topics}}
              <div class="discussion-sidebar">
                <h5>MY ACTIVE TOPICS</h5>
                <hr>
                <p>one</p>
                <hr>
                <p>one</p>
              </div>

              {{else}}
              {{! @todo if not logged in display 5 related topics}}
              <div class="discussion-sidebar">
                <h5>RELATED TOPICS</h5>
                <hr>
                <p>one</p>
                <hr>
                <p>one</p>
              </div>
            {{/if}}
          </div>
          <!-- right sidebar ends -->

        </div>





      {{/with}}
    {{else}}
      {{> loading}}
    {{/if}}
  </div>
  </div>

</template>
